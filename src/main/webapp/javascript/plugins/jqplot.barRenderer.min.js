/**
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: 1.0.0b2_r1012
 *
 * Copyright (c) 2009-2011 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 *
 * included jsDate library by Chris Leonello:
 *
 * Copyright (c) 2010-2011 Chris Leonello
 *
 * jsDate is currently available for use in all personal or commercial projects 
 * under both the MIT and GPL version 2.0 licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly.
 *
 * jsDate borrows many concepts and ideas from the Date Instance 
 * Methods by Ken Snyder along with some parts of Ken's actual code.
 * 
 * Ken's origianl Date Instance Methods and copyright notice:
 * 
 * Ken Snyder (ken d snyder at gmail dot com)
 * 2008-09-10
 * version 2.0.2 (http://kendsnyder.com/sandbox/date/)     
 * Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0/)
 *
 * jqplotToImage function based on Larry Siden's export-jqplot-to-png.js.
 * Larry has generously given permission to adapt his code for inclusion
 * into jqPlot.
 *
 * Larry's original code can be found here:
 *
 * https://github.com/lsiden/export-jqplot-to-png
 * 
 * 
 */
(function(a){function l(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];var h=e.plugins.barRenderer.highlightedSeriesIndex;if(h!=null&&e.series[h].highlightMouseDown){g(e)}var i=jQuery.Event("jqplotDataRightClick");i.pageX=a.pageX;i.pageY=a.pageY;e.target.trigger(i,f)}}function k(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data];var g=jQuery.Event("jqplotDataClick");g.pageX=a.pageX;g.pageY=a.pageY;e.target.trigger(g,f)}}function j(a,b,c,d,e){var f=e.plugins.barRenderer.highlightedSeriesIndex;if(f!=null&&e.series[f].highlightMouseDown){g(e)}}function i(a,b,c,d,e){if(d){var h=[d.seriesIndex,d.pointIndex,d.data];if(e.series[h[0]].highlightMouseDown&&!(h[0]==e.plugins.barRenderer.highlightedSeriesIndex&&h[1]==e.series[h[0]]._highlightedPoint)){var i=jQuery.Event("jqplotDataHighlight");i.pageX=a.pageX;i.pageY=a.pageY;e.target.trigger(i,h);f(e,d.seriesIndex,d.pointIndex,d.points)}}else if(d==null){g(e)}}function h(a,b,c,d,e){if(d){var h=[d.seriesIndex,d.pointIndex,d.data];var i=jQuery.Event("jqplotDataMouseOver");i.pageX=a.pageX;i.pageY=a.pageY;e.target.trigger(i,h);if(e.series[h[0]].highlightMouseOver&&!(h[0]==e.plugins.barRenderer.highlightedSeriesIndex&&h[1]==e.series[h[0]]._highlightedPoint)){var j=jQuery.Event("jqplotDataHighlight");j.pageX=a.pageX;j.pageY=a.pageY;e.target.trigger(j,h);f(e,d.seriesIndex,d.pointIndex,d.points)}}else if(d==null){g(e)}}function g(a){var b=a.plugins.barRenderer.highlightCanvas;b._ctx.clearRect(0,0,b._ctx.canvas.width,b._ctx.canvas.height);for(var c=0;c<a.series.length;c++){a.series[c]._highlightedPoint=null}a.plugins.barRenderer.highlightedSeriesIndex=null;a.target.trigger("jqplotDataUnhighlight");b=null}function f(a,b,c,d){var e=a.series[b];var f=a.plugins.barRenderer.highlightCanvas;f._ctx.clearRect(0,0,f._ctx.canvas.width,f._ctx.canvas.height);e._highlightedPoint=c;a.plugins.barRenderer.highlightedSeriesIndex=b;var g={fillStyle:e.highlightColors[c]};e.renderer.shapeRenderer.draw(f._ctx,d,g);f=null}function e(){if(this.plugins.barRenderer&&this.plugins.barRenderer.highlightCanvas){this.plugins.barRenderer.highlightCanvas.resetCanvas();this.plugins.barRenderer.highlightCanvas=null}this.plugins.barRenderer={highlightedSeriesIndex:null};this.plugins.barRenderer.highlightCanvas=new a.jqplot.GenericCanvas;this.eventCanvas._elem.before(this.plugins.barRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-barRenderer-highlight-canvas",this._plotDimensions,this));this.plugins.barRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(a){g(a.data.plot)})}function d(b,c,d){for(var e=0;e<this.series.length;e++){if(this.series[e].renderer.constructor==a.jqplot.BarRenderer){if(this.series[e].highlightMouseOver){this.series[e].highlightMouseDown=false}}}}function c(b){var c=[];for(var d=0;d<b.length;d++){var e=a.jqplot.getColorComponents(b[d]);var f=[e[0],e[1],e[2]];var g=f[0]+f[1]+f[2];for(var h=0;h<3;h++){f[h]=g>570?f[h]*.8:f[h]+.3*(255-f[h]);f[h]=parseInt(f[h],10)}c.push("rgb("+f[0]+","+f[1]+","+f[2]+")")}return c}function b(b,c,d,e){if(this.rendererOptions.barDirection=="horizontal"){this._stackAxis="x";this._primaryAxis="_yaxis"}if(this.rendererOptions.waterfall==true){this._data=a.extend(true,[],this.data);var f=0;var g=!this.rendererOptions.barDirection||this.rendererOptions.barDirection==="vertical"||this.transposedData===false?1:0;for(var h=0;h<this.data.length;h++){f+=this.data[h][g];if(h>0){this.data[h][g]+=this.data[h-1][g]}}this.data[this.data.length]=g==1?[this.data.length+1,f]:[f,this.data.length+1];this._data[this._data.length]=g==1?[this._data.length+1,f]:[f,this._data.length+1]}if(this.rendererOptions.groups>1){this.breakOnNull=true;var i=this.data.length;var j=parseInt(i/this.rendererOptions.groups,10);var k=0;for(var h=j;h<i;h+=j){this.data.splice(h+k,0,[null,null]);k++}for(h=0;h<this.data.length;h++){if(this._primaryAxis=="_xaxis"){this.data[h][0]=h+1}else{this.data[h][1]=h+1}}}}a.jqplot.BarRenderer=function(){a.jqplot.LineRenderer.call(this)};a.jqplot.BarRenderer.prototype=new a.jqplot.LineRenderer;a.jqplot.BarRenderer.prototype.constructor=a.jqplot.BarRenderer;a.jqplot.BarRenderer.prototype.init=function(b,c){this.barPadding=8;this.barMargin=10;this.barDirection="vertical";this.barWidth=null;this.shadowOffset=2;this.shadowDepth=5;this.shadowAlpha=.08;this.waterfall=false;this.groups=1;this.manualBarColor=false;this.varyBarColor=false;this.highlightMouseOver=true;this.highlightMouseDown=false;this.highlightColors=[];this.transposedData=true;this.renderer.animation={show:false,direction:"down",speed:3e3,_supported:true};this._type="bar";if(b.highlightMouseDown&&b.highlightMouseOver==null){b.highlightMouseOver=false}a.extend(true,this,b);a.extend(true,this.renderer,b);this.fill=true;if(this.barDirection==="horizontal"&&this.rendererOptions.animation&&this.rendererOptions.animation.direction==null){this.renderer.animation.direction="left"}if(this.waterfall){this.fillToZero=false;this.disableStack=true}if(this.barDirection=="vertical"){this._primaryAxis="_xaxis";this._stackAxis="y";this.fillAxis="y"}else{this._primaryAxis="_yaxis";this._stackAxis="x";this.fillAxis="x"}this._highlightedPoint=null;this._plotSeriesInfo=null;this._dataColors=[];this._barPoints=[];var f={lineJoin:"miter",lineCap:"round",fill:true,isarc:false,strokeStyle:this.color,fillStyle:this.color,closePath:this.fill};this.renderer.shapeRenderer.init(f);var g={lineJoin:"miter",lineCap:"round",fill:true,isarc:false,angle:this.shadowAngle,offset:this.shadowOffset,alpha:this.shadowAlpha,depth:this.shadowDepth,closePath:this.fill};this.renderer.shadowRenderer.init(g);c.postInitHooks.addOnce(d);c.postDrawHooks.addOnce(e);c.eventListenerHooks.addOnce("jqplotMouseMove",h);c.eventListenerHooks.addOnce("jqplotMouseDown",i);c.eventListenerHooks.addOnce("jqplotMouseUp",j);c.eventListenerHooks.addOnce("jqplotClick",k);c.eventListenerHooks.addOnce("jqplotRightClick",l)};a.jqplot.preSeriesInitHooks.push(b);a.jqplot.BarRenderer.prototype.calcSeriesNumbers=function(){var b=0;var c=0;var d=this[this._primaryAxis];var e,f,g;for(var h=0;h<d._series.length;h++){f=d._series[h];if(f===this){g=h}if(f.renderer.constructor==a.jqplot.BarRenderer){b+=f.data.length;c+=1}}return[b,c,g]};a.jqplot.BarRenderer.prototype.setBarWidth=function(){var a;var b=0;var c=0;var d=this[this._primaryAxis];var e,f,g;var h=this._plotSeriesInfo=this.renderer.calcSeriesNumbers.call(this);b=h[0];c=h[1];var i=d.numberTicks;var j=(i-1)/2;if(d.name=="xaxis"||d.name=="x2axis"){if(this._stack){this.barWidth=(d._offsets.max-d._offsets.min)/b*c-this.barMargin}else{this.barWidth=((d._offsets.max-d._offsets.min)/j-this.barPadding*(c-1)-this.barMargin*2)/c}}else{if(this._stack){this.barWidth=(d._offsets.min-d._offsets.max)/b*c-this.barMargin}else{this.barWidth=((d._offsets.min-d._offsets.max)/j-this.barPadding*(c-1)-this.barMargin*2)/c}}return[b,c]};a.jqplot.BarRenderer.prototype.draw=function(b,c,d){var e;var f=a.extend({},d);var g=f.shadow!=undefined?f.shadow:this.shadow;var h=f.showLine!=undefined?f.showLine:this.showLine;var i=f.fill!=undefined?f.fill:this.fill;var j=this.xaxis;var k=this.yaxis;var l=this._xaxis.series_u2p;var m=this._yaxis.series_u2p;var n,o;this._dataColors=[];this._barPoints=[];if(this.barWidth==null){this.renderer.setBarWidth.call(this)}var p=this._plotSeriesInfo=this.renderer.calcSeriesNumbers.call(this);var q=p[0];var r=p[1];var s=p[2];var t=[];if(this._stack){this._barNudge=0}else{this._barNudge=(-Math.abs(r/2-.5)+s)*(this.barWidth+this.barPadding)}if(h){var u=new a.jqplot.ColorGenerator(this.negativeSeriesColors);var v=new a.jqplot.ColorGenerator(this.seriesColors);var w=u.get(this.index);if(!this.useNegativeColors){w=f.fillStyle}var x=f.fillStyle;var y;var z;var A;if(this.barDirection=="vertical"){for(var e=0;e<c.length;e++){if(this.data[e][1]==null){continue}t=[];y=c[e][0]+this._barNudge;A;if(this._stack&&this._prevGridData.length){A=this._prevGridData[e][1]}else{if(this.fillToZero){A=this._yaxis.series_u2p(0)}else if(this.waterfall&&e>0&&e<this.gridData.length-1){A=this.gridData[e-1][1]}else if(this.waterfall&&e==0&&e<this.gridData.length-1){if(this._yaxis.min<=0&&this._yaxis.max>=0){A=this._yaxis.series_u2p(0)}else if(this._yaxis.min>0){A=b.canvas.height}else{A=0}}else if(this.waterfall&&e==this.gridData.length-1){if(this._yaxis.min<=0&&this._yaxis.max>=0){A=this._yaxis.series_u2p(0)}else if(this._yaxis.min>0){A=b.canvas.height}else{A=0}}else{A=b.canvas.height}}if(this.fillToZero&&this._plotData[e][1]<0||this.waterfall&&this._data[e][1]<0){if(this.varyBarColor&&!this._stack){if(this.useNegativeColors){f.fillStyle=u.next()}else{f.fillStyle=v.next()}}else{f.fillStyle=w}}else{if(this.manualBarColor){f.fillStyle=v.next()}else if(this.varyBarColor&&!this._stack){f.fillStyle=v.next()}else{f.fillStyle=x}}if(!this.fillToZero||this._plotData[e][1]>=0){t.push([y-this.barWidth/2,A]);t.push([y-this.barWidth/2,c[e][1]]);t.push([y+this.barWidth/2,c[e][1]]);t.push([y+this.barWidth/2,A])}else{t.push([y-this.barWidth/2,c[e][1]]);t.push([y-this.barWidth/2,A]);t.push([y+this.barWidth/2,A]);t.push([y+this.barWidth/2,c[e][1]])}this._barPoints.push(t);if(g&&!this._stack){var B=a.extend(true,{},f);delete B.fillStyle;this.renderer.shadowRenderer.draw(b,t,B)}var C=f.fillStyle||this.color;this._dataColors.push(C);this.renderer.shapeRenderer.draw(b,t,f)}}else if(this.barDirection=="horizontal"){for(var e=0;e<c.length;e++){if(this.data[e][0]==null){continue}t=[];y=c[e][1]-this._barNudge;z;if(this._stack&&this._prevGridData.length){z=this._prevGridData[e][0]}else{if(this.fillToZero){z=this._xaxis.series_u2p(0)}else if(this.waterfall&&e>0&&e<this.gridData.length-1){z=this.gridData[e-1][1]}else if(this.waterfall&&e==0&&e<this.gridData.length-1){if(this._xaxis.min<=0&&this._xaxis.max>=0){z=this._xaxis.series_u2p(0)}else if(this._xaxis.min>0){z=0}else{z=b.canvas.width}}else if(this.waterfall&&e==this.gridData.length-1){if(this._xaxis.min<=0&&this._xaxis.max>=0){z=this._xaxis.series_u2p(0)}else if(this._xaxis.min>0){z=0}else{z=b.canvas.width}}else{z=0}}if(this.fillToZero&&this._plotData[e][1]<0||this.waterfall&&this._data[e][1]<0){if(this.varyBarColor&&!this._stack){if(this.useNegativeColors){f.fillStyle=u.next()}else{f.fillStyle=v.next()}}}else{if(this.varyBarColor&&!this._stack){f.fillStyle=v.next()}else{f.fillStyle=x}}if(!this.fillToZero||this._plotData[e][0]>=0){t.push([z,y+this.barWidth/2]);t.push([z,y-this.barWidth/2]);t.push([c[e][0],y-this.barWidth/2]);t.push([c[e][0],y+this.barWidth/2])}else{t.push([c[e][0],y+this.barWidth/2]);t.push([c[e][0],y-this.barWidth/2]);t.push([z,y-this.barWidth/2]);t.push([z,y+this.barWidth/2])}this._barPoints.push(t);if(g&&!this._stack){var B=a.extend(true,{},f);delete B.fillStyle;this.renderer.shadowRenderer.draw(b,t,B)}var C=f.fillStyle||this.color;this._dataColors.push(C);this.renderer.shapeRenderer.draw(b,t,f)}}}if(this.highlightColors.length==0){this.highlightColors=a.jqplot.computeHighlightColors(this._dataColors)}else if(typeof this.highlightColors=="string"){var p=this.highlightColors;this.highlightColors=[];for(var e=0;e<this._dataColors.length;e++){this.highlightColors.push(p)}}};a.jqplot.BarRenderer.prototype.drawShadow=function(a,b,c){var d;var e=c!=undefined?c:{};var f=e.shadow!=undefined?e.shadow:this.shadow;var g=e.showLine!=undefined?e.showLine:this.showLine;var h=e.fill!=undefined?e.fill:this.fill;var i=this.xaxis;var j=this.yaxis;var k=this._xaxis.series_u2p;var l=this._yaxis.series_u2p;var m,n,o,p,q,r;if(this._stack&&this.shadow){if(this.barWidth==null){this.renderer.setBarWidth.call(this)}var s=this._plotSeriesInfo=this.renderer.calcSeriesNumbers.call(this);p=s[0];q=s[1];r=s[2];if(this._stack){this._barNudge=0}else{this._barNudge=(-Math.abs(q/2-.5)+r)*(this.barWidth+this.barPadding)}if(g){if(this.barDirection=="vertical"){for(var d=0;d<b.length;d++){if(this.data[d][1]==null){continue}n=[];var t=b[d][0]+this._barNudge;var u;if(this._stack&&this._prevGridData.length){u=this._prevGridData[d][1]}else{if(this.fillToZero){u=this._yaxis.series_u2p(0)}else{u=a.canvas.height}}n.push([t-this.barWidth/2,u]);n.push([t-this.barWidth/2,b[d][1]]);n.push([t+this.barWidth/2,b[d][1]]);n.push([t+this.barWidth/2,u]);this.renderer.shadowRenderer.draw(a,n,e)}}else if(this.barDirection=="horizontal"){for(var d=0;d<b.length;d++){if(this.data[d][0]==null){continue}n=[];var t=b[d][1]-this._barNudge;var v;if(this._stack&&this._prevGridData.length){v=this._prevGridData[d][0]}else{v=0}n.push([v,t+this.barWidth/2]);n.push([b[d][0],t+this.barWidth/2]);n.push([b[d][0],t-this.barWidth/2]);n.push([v,t-this.barWidth/2]);this.renderer.shadowRenderer.draw(a,n,e)}}}}}})(jQuery)