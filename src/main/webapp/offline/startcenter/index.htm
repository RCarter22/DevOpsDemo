<!DOCTYPE html>
<html ng-app="emm" ng-controller="MainController" ng-cloak>
	<head>
		<title>EZMaxMobile - Offline</title>
		<emm:include value="../common/includes.htm"/>
	</head>
	<body>
		<div class="ui-page">
			<emm:include value="../common/menu.htm"/>
			<div class="ui-statusbar ui-statusbar-f">
				<h5 class="ui-title" translate="OFFLINEMODE">Offline Mode</h5>
			</div>
			<ul class="ui-navbar" ng-show="startCenters">
				<li ng-repeat="sc in startCenters">
					<a ng-click = "goToTemplate(sc)" ng-class="{'ui-active' : selectedTemplate === sc.SCCONFIGID}">{{sc.DESCRIPTION}}</a>
				</li>
			</ul>
			<div class="ui-statusbar ui-statusbar-c" ng-hide="portlets">
				<h3 class="ui-title" >No Portlets Configured</h3>
			</div>
			<div class="ui-content">	
				<ul class="ui-listview">
					<li ng-repeat="portlet in portlets">
						<a ng-click="goToResultSet(portlet)">
							<img ng-src="{{findAppImage(portlet.QUERYAPP)}}">
							<h3>{{portlet.DESCRIPTION}}</h3>
							<span class="ui-arrow"></span>
						</a>
					</li>
				</ul> 
			</div>			
		</div>	
		<script type="text/javascript"> 
			function MainController ($scope, applicationService,startCenterService){
				$scope.userInfo = EMMServer.DB.getUserInfo();				
				$scope.TXNCOUNT = EMMServer.DB.getUserTxnCount();
				$scope.appService = applicationService;
				$scope.startCenters = EMMServer.DB.getQueryResult("STARTCENTERS");
				$scope.portlets = EMMServer.DB.getQueryResult("PORTLETS");
				$scope.imgDir="../../images/";
				startCenterService.init({
					userInfo : $scope.userInfo
				});
				var supportedApps = applicationService.getSupportedApps();
				$scope.findAppImage = function(appName){
					var baseDir = "../../images/";
					for(var i = 0; i < supportedApps.length; i++){
						var appObj = supportedApps[i];
						if(appObj[0] == appName){
							return baseDir += appObj[2];
						}
					}
					return baseDir +="dashboard.png";
				}
				/* $(
				function(){
					if(!EMMServer.Session.getItem('SELECTEDSC'))
						$('.ui-navbar a:first').click();
					else
						 {
						if($('.ui-navbar a').length === 0){
							var scconfigid = EMMServer.Session.getItem("SELECTEDSC");
							
							EMMServer.DB.Select()
							.addQuery("STARTCENTERS", "SELECT * FROM STARTCENTER")
							.addQuery("PORTLETS", "SELECT * FROM PORTLET WHERE SCCONFIGID = '" + scconfigid + "' ORDER BY ORDERNUM")
							.submit("offline/startcenter/index.htm", true);		
							}
						} 
				}); */
				$scope.selectedTemplate = startCenterService.helper.findSelectedSC($scope.startCenters).toString();
			
				var actions = {
					offline: function(){
						EMMServer.DB.Select()
							.addQuery("DUMMY", "SELECT 1")
							.submit("offline/login/index.htm", true);
					}
				}			
				$scope.goToTemplate = startCenterService.goToTemplate;
				
				$scope.goToResultSet = function(portlet){
					startCenterService.goToPortlet(portlet);
				}
			}
		</script>	
	</body>
</html>
